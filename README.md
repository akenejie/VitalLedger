# VitalLedger

※ このデータベースはまだ検証が不十分です。また、フロントエンドが制作できていません。

**「お金」と「栄養」を一つの流れとして統合管理する、究極のライフログ・データベース**

このプロジェクトは、単なる家計簿でも、単なるダイエット記録でもありません。
「通貨としてのポイント」「冷蔵庫の在庫」「摂取した栄養素」「消費税の端数処理」に至るまで、現実世界の商習慣と食生活を忠実に再現することを試みるデータベースです。

## 特徴とこだわり

既存の家計簿アプリや栄養管理アプリに不満を感じたことはありませんか？
本データベースは、以下の **4つの革新的な設計思想** によって、これまでのアプリでは手の届かなかった厳密な管理を実現します。

### 1. 「商流」と「金流」の完全分離

多くのアプリは「買った商品」と「支払額」をセットで扱いますが、現実はそう単純ではありません。

* **商品は空っぽでお金だけ動く**（給料、お小遣い）
* **お金は払わないが商品は増える**（貰い物、ポイント交換）
* **商品合計と支払合計が一致しない**（ポイント還元）

このデータベースでは、**「商品の配列」と「資金移動の配列」を独立して管理**します。これにより、どんな複雑な決済やポイント還元も、現実のままに記録可能です。

### 2. ポイントを「通貨」として一般化

「A社ポイント」も「米ドル」も、そして「日本円」さえも、すべて等しく **「期限と用途制限を設定できるデータ」** として扱います。

* 全ての資金移動データに `expiry_at`（有効期限）と `usage_restriction`（用途制限）のカラムを実装。
* 「来月切れる期間限定のお金を使って支払う」という消込処理を追跡可能。

### 3. 日本の商習慣に即した消費税計算

「商品ごとに税計算して合算」では、実際のレシートと1円のズレが生じることがあります。
本データベースは **「取引全体の商品を合算してから、最後に一度だけ端数処理（切り捨て・四捨五入）を行う」** という日本の会計ルールに対応するため、日本のレシートに準拠した「取引」の概念を扱い、基本切り捨て、店舗の判断による四捨五入によってまれにずれる1円を `tax_adjustment_jpy` ヘッダーで調整することで、1円単位の完全な整合性を確保します。

### 4. 購入から食品在庫となり、やがて栄養となるまで：在庫・栄養のシームレス連携

食品カテゴリに分類される商品を買った瞬間、それは「出費」であると同時に「食品在庫」になります。

1. **Purchase**: レシート入力で `FRIDGE`（冷蔵庫）や `PANTRY`（保存庫）へ自動入庫。
2. **Inventory**: 同じ「じゃがいも」でも、「先週買った北海道産」と「昨日買った特売品」を別に管理。
3. **Meal**: 料理をする際は、特定の在庫を引き当てて消費。
4. **Nutrition**: 食べたものだけが栄養として計上され、腐らせて捨てたもの（LOSS）はコストとしてのみ計上。

## 🏗 System Architecture

本データベースは SQLite 上に構築されており、大きく5つの分類で構成されています。

### I. 通貨・価値管理

ポイントも現金も包括的に管理します。

* **`m_currencies`**: 円、米ドル、各種ポイントを定義。
* **`m_wallets`**: 財布、銀行口座、ポイントカードのアカウント。
* **`t_currency_rates`**: レート変動やデノミネーション（併合・分割）の履歴。

### II. 食品・栄養基盤

食品の性質に合わせて3つのマスタで管理し、10種の味覚データまで保持します。

* **`m_foods_universal`**: 野菜・果物など、個数や本数で管理する普遍的な食品。
* **`m_foods_measured`**: 肉・魚・調味料など、重量(g)で管理する食品。
* **`m_foods_processed`**: カップ麺・外食など、1食単位で完結する加工品。

### III. 商流

「何を買ったか」を記録します。

* **`m_store_branches` / `m_brands**`: 店舗とブランドの親子関係。
* **`t_transactions`**: 取引ヘッダー。日時と合計金額、税調整額を管理。
* **`t_transaction_details`**: レシートの明細行。ここで `food_type` を指定し、食品マスタとリンクさせます。

### IV. 金流

「どう支払ったか（受け取ったか）」を記録します。

* **`t_payments`**: 資金の増減ログ。ここにも期限や用途制限が付与されます。
* **`t_wallet_balances`**: 各財布の残高スナップショット。

### V. 食品在庫

購入後の食品の行方を追跡します。

* **`t_inventory`**: 購入明細(`detail_id`)に紐付いた在庫の実体。
* **`t_meal_logs`**: 食事のイベント（朝食、夕食など）。
* **`t_meal_details`**: 「どの在庫を、どれだけ、どう消費したか（摂取/廃棄/譲渡）」の詳細。

## 📊 今後の展望
* Python と LibreOffice Base をフロントエンドとして、Linux / Windows / macOS での操作に対応する。
* 1年程度アケネＪが検証してデータベースの構造を修正する。
* Android 用のフロントエンド（アプリ）を開発する。

## 📝 License

The source code is licensed GNU Affero General Public License v3.0（AGPL‑3.0）

---

*Created by アケネＪ / Akenejie*
